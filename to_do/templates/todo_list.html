{% extends 'base.html' %}
{% block page_title %}Home Page{% endblock %}


{% block icon_cards %}
<!-- Icon Cards - will display icons at the top of the home page and count issues and features  -->
<div class="row">

    <!-- Icon card for issues -->
    <div class="col-xl-6 col-sm-6 mb-3">
        <div class="card text-white bg-primary o-hidden h-100">

            <div class="card-body">
                <div class="card-body-icon">
                    <i class="fa fa-fw fa-comments"></i>
                </div>
                    
                <!-- Total issues count -->
                <div class="mr-5">{{items.count}} Total Issues</div>

                <!-- Pending issues count -->
                {% for not_done in not_done_issues_count %}
                <div class="mr-5">{{not_done}} Pending Issues</div>
                {% endfor %}

            </div> <!-- Close card-body class -->

            <!-- Link to products page -->
            <a class="card-footer text-white clearfix small z-1" href="{% url 'all_products' %}">
                <span class="float-left">Buy urgent issue ticket</span>
                <span class="float-right">
                    <i class="fa fa-angle-right"></i>
                </span>
            </a>
        </div> <!-- Close card class -->
    </div> <!-- Close col class -->

    <!-- Icon card for features -->
    <div class="col-xl-6 col-sm-6 mb-3">

        <div class="card text-white bg-success o-hidden h-100">
            <div class="card-body">
                <div class="card-body-icon">
                    <i class="fa fa-fw fa-list"></i>
                </div>

                <!-- Count features -->
                {% if name.count == 0 %}
                    <div class="mr-5">No Feature Requests</div>
                {% else %}
                    <div class="mr-5">{{name.count}} Total Features</div>
                {% endif %}

                <!-- Count features pending to do -->
                {% for features_to_do in pending_features_to_do_count %}
                    <div class="mr-5">{{features_to_do}} Pending Features</div>
                {% endfor %}
            </div>
            
            <!-- Link to products page -->
            <a class="card-footer text-white clearfix small z-1" href="{% url 'all_products' %}">
                <span class="float-left">Buy feature ticket</span>
                <span class="float-right">
                    <i class="fa fa-angle-right"></i>
                </span>
            </a>
            
        </div> <!-- Close card class -->
    </div> <!-- Close col class -->
</div> <!-- Close row -->
{% endblock %}

{% block body_text %}

<div class="container">

    <!-- Displays relevant messages depending on user actions -->
    <div class="container margin_bottom">
        <div class="row">
            <div class="col-sm-12">
                {% if messages %}
                    {% for message in messages %}
                        {{message}}
                    {% endfor %}
                {% endif %}
            </div>
        </div>
    </div>
    <br>

    <!-- Table for issues and separate table for features -->
    <div class="container">
        <div class="row">
            <div class="col-sm-12">

                <!-- Table showing issue requests to do -->
                <h2>Issues to fix</h2>
                <p><a href="{% url 'new_issue' %}">Open a new free issue ticket</a></p>
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Issue</th>
                            <th scope="col">Status</th>
                            <th scope="col">Upvotes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in items %}

                        <tr>
                            <!-- Nothing is displayed if an issue is marked as done -->
                            {% if item.done %}

                            <!-- Look for all pending issues -->
                            {% else %}

                                <!-- Check if a user is logged in. If they are, they can upvote an issue -->
                                {% if user.is_authenticated %}
        
                                    <td>
                                        <p>{{item.Issue | title }}</p>
                                        <p><b>added:</b> {{ item.date_created }}</p>
                                    </td>
            
                                    <td>In Progress</td>

                                    <td>
                                        <!-- This is the code that allows a logged in user to upvote an issue -->
                                        <form method="POST" action="toggle/{{ item.id }}">{% csrf_token %}<button
                                                class="plain_button border-radius-button like_button"><i
                                                    class="fa fa-thumbs-o-up"></i></button>{{ item.likes.count }}</form>
                                    </td>
        
                                <!-- If the user isn't logged in they will be sent an alert telling them to log in before they can upvote an issue -->
                                {% else %}
                                
                                    <td>
                                        <p>{{item.Issue | title }}</p>
                                        <p><b>added:</b> {{ item.date_created }}</p>
                                    </td>
            
                                    <td>In Progress</td>
            
                                    <!-- This is the code that has an extra class which will activate an alert to login
                                    before a user can upvote an issue -->
                                    <td>
                                        <button class="plain_button border-radius-button login_to_like like_button"><i
                                                class="fa fa-thumbs-o-up"></i></button>{{ item.likes.count }}
                                    </td>
        
                                {% endif %}

                            {% endif %}
                        </tr>
                        {% empty %}
                        <p>No issues, for now...</p>
                        {% endfor %}
                    </tbody>
                </table>
            </div> <!-- closing col-sm class -->
        </div> <!-- closing row  -->

        <div class="row">
            <div class="col-sm-12">
                <!-- Displays issues that have been resolved -->
                <h2>Resolved Issues</h2>
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Issue</th>
                            <th scope="col">Status</th>
                            <th scope="col">Last Updated</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for done_items in items %}
                        <tr class="table-success">
                            {% if done_items.done %}
                            <td><strike>{{done_items.Issue | title}}</strike></td>
                            <td>Complete</td>
                            <td>{{ done_items.last_updated }}</td>
                            {% endif %}
                        </tr>

                        {% empty %}
                        <p>Nothing solved, for now...</p>
                        {% endfor %}
                    </tbody>
                </table>
            </div> <!-- closing sm class -->
        </div> <!-- closing row for table for resolved issues -->
    </div> <!-- closing container -->

    <!-- Features table -->
    <div class="container margin_top">
        <div class="row">
            <div class="col-sm-12">
                <h2>New Feature Requests</h2>
                <p><a href="{% url 'all_products' %}">Request a new feature ticket</a></p>
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Feature</th>
                            <th scope="col">Status</th>
                            <th scope="col">Upvotes</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for feature in name %}

                        <tr>
                            <!-- Features that are completed are ignored -->
                            {% if feature.done %}

                            <!-- Pending features are displayed here -->
                            {% else %}
                            
                            <!-- Check if a user is logged in. If they are they can upvote a feature -->
                            {% if user.is_authenticated %}

                                <td>
                                    <p>{{feature.name | title }}</p>
                                    <p><b>added:</b> {{ feature.date_created }}</p>
                                </td>

                                <td>In Progress</td>

                                <td>
                                    <!-- The code for upvoting a feature when logged in -->
                                    <form method="POST" action="toggle/{{ feature.id }}">{% csrf_token %}<button class="plain_button border-radius-button like_button"><i
                                                class="fa fa-thumbs-o-up"></i></button>{{ feature.likes.count }}</form>
                                </td>

                            <!-- If the user isn't logged in they will be given an alert telling them to log in before
                            they can upvote a feature -->
                            {% else %}
                                <td>
                                    <p>{{feature.name | title }}</p>
                                    <p><b>added:</b> {{ feature.date_created }}</p>
                                </td>

                                <td>In Progress</td>

                                <td>
                                    <!-- Code with an extra class that will pop up an alert telling users to login before upvoting -->
                                    <button class="plain_button border-radius-button login_to_like like_button"><i
                                            class="fa fa-thumbs-o-up"></i></button>{{ feature.likes.count }}
                                </td>

                            {% endif %}

                            {% endif %}
                        </tr>
                        {% empty %}
                        <p>No features, for now...</p>
                        {% endfor %}
                    </tbody>
                </table>
            </div> <!-- closing sm class -->
        </div> <!-- closing row -->

        <!-- Table for features that have been completed -->
        <div class="row">
            <div class="col-sm-12">
                <h2>New Features Implemented</h2>
                <table class="table">
                    <thead class="thead-dark">
                        <tr>
                            <th scope="col">Feature</th>
                            <th scope="col">Status</th>
                            <th scope="col">Last Updated</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for done_feature in name %}
                        <tr class="table-success">
                            {% if done_feature.done %}
                            <td><strike>{{done_feature.name | title}}</strike></td>
                            <td>Complete</td>
                            <td>{{ done_feature.last_updated }}</td>
                            {% endif %}
                        </tr>

                        {% empty %}
                        <p>No new features Implemented, for now...</p>
                        {% endfor %}
                    </tbody>
                </table>
            </div> <!-- closing sm class -->
        </div> <!-- closing row for implemented features  -->
    </div> <!-- closing container -->


    <!-- Scroll to Top Button-->
    <a class="rounded" href="#page-top">
        <i class="fa fa-arrow-circle-up"></i>
    </a>
    
</div> <!-- Closing container class -->


{% endblock %}


